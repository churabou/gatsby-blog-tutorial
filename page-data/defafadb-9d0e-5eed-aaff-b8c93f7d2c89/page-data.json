{"componentChunkName":"component---src-templates-post-js","path":"/defafadb-9d0e-5eed-aaff-b8c93f7d2c89","result":{"data":{"markdownRemark":{"html":"<p>qiitaの記事がobjcだったのでサクッとコピペで動かしたい方に最新版のコードを共有</p>\n<h3>UILabelにUIImageを表示する方法</h3>\n<p>①NSTextAttachmentを作成する。\n②NSTextAttachmentからNSAttributedStringを作成する。\n③UILabelのattributedTextに指定する。</p>\n<p>画像のサイズや表示位置は①で調整します</p>\n<p>今回は実際に起こりそうなものとして、ラベルの末尾に画像を表示してみます</p>\n<img width=\"286\" alt=\"スクリーンショット 2019-05-10 11.59.12.png\" src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/166241/9499259e-9a49-9ead-4243-78503e762f0f.png\">\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\">    <span class=\"token keyword\">override</span> <span class=\"token keyword\">func</span> <span class=\"token function\">viewDidLoad</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">super</span><span class=\"token punctuation\">.</span><span class=\"token function\">viewDidLoad</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n               \n        <span class=\"token keyword\">let</span> text <span class=\"token operator\">=</span> <span class=\"token string\">\"labelに犬を表示する\"</span>\n        <span class=\"token keyword\">let</span> image <span class=\"token operator\">=</span> <span class=\"token function\">UIImage</span><span class=\"token punctuation\">(</span>named<span class=\"token punctuation\">:</span> <span class=\"token string\">\"dog.jpg\"</span><span class=\"token punctuation\">)</span><span class=\"token operator\">!</span>\n        <span class=\"token keyword\">let</span> font<span class=\"token punctuation\">:</span> <span class=\"token builtin\">UIFont</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">.</span><span class=\"token function\">systemFont</span><span class=\"token punctuation\">(</span>ofSize<span class=\"token punctuation\">:</span> <span class=\"token number\">30</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">let</span> size <span class=\"token operator\">=</span> <span class=\"token function\">CGSize</span><span class=\"token punctuation\">(</span>width<span class=\"token punctuation\">:</span> <span class=\"token number\">30</span><span class=\"token punctuation\">,</span> height<span class=\"token punctuation\">:</span> <span class=\"token number\">30</span><span class=\"token punctuation\">)</span>\n        \n        <span class=\"token keyword\">let</span> attachment <span class=\"token operator\">=</span> <span class=\"token function\">NSTextAttachment</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        attachment<span class=\"token punctuation\">.</span>image <span class=\"token operator\">=</span> image\n\n        <span class=\"token keyword\">let</span> y <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>font<span class=\"token punctuation\">.</span>capHeight<span class=\"token operator\">-</span>size<span class=\"token punctuation\">.</span>height<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">rounded</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> <span class=\"token number\">2</span>\n        attachment<span class=\"token punctuation\">.</span>bounds<span class=\"token punctuation\">.</span>origin <span class=\"token operator\">=</span> <span class=\"token function\">CGPoint</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> y<span class=\"token punctuation\">:</span> y<span class=\"token punctuation\">)</span>\n        attachment<span class=\"token punctuation\">.</span>bounds<span class=\"token punctuation\">.</span>size <span class=\"token operator\">=</span> size\n        \n        <span class=\"token keyword\">let</span> imageAttribute <span class=\"token operator\">=</span> <span class=\"token function\">NSAttributedString</span><span class=\"token punctuation\">(</span>attachment<span class=\"token punctuation\">:</span> attachment<span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">let</span> mutableString <span class=\"token operator\">=</span> <span class=\"token function\">NSMutableAttributedString</span><span class=\"token punctuation\">(</span>string<span class=\"token punctuation\">:</span> text<span class=\"token punctuation\">)</span>\n        mutableString<span class=\"token punctuation\">.</span><span class=\"token function\">insert</span><span class=\"token punctuation\">(</span>imageAttribute<span class=\"token punctuation\">,</span> at<span class=\"token punctuation\">:</span> text<span class=\"token punctuation\">.</span><span class=\"token builtin\">count</span><span class=\"token punctuation\">)</span>\n        \n        <span class=\"token keyword\">let</span> label <span class=\"token operator\">=</span> <span class=\"token function\">UILabel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        view<span class=\"token punctuation\">.</span><span class=\"token function\">addSubview</span><span class=\"token punctuation\">(</span>label<span class=\"token punctuation\">)</span>\n        label<span class=\"token punctuation\">.</span>textAlignment <span class=\"token operator\">=</span> <span class=\"token punctuation\">.</span>center\n        label<span class=\"token punctuation\">.</span>frame<span class=\"token punctuation\">.</span>size <span class=\"token operator\">=</span> <span class=\"token punctuation\">.</span><span class=\"token keyword\">init</span><span class=\"token punctuation\">(</span>width<span class=\"token punctuation\">:</span> view<span class=\"token punctuation\">.</span>bounds<span class=\"token punctuation\">.</span>width<span class=\"token operator\">-</span><span class=\"token number\">20</span><span class=\"token punctuation\">,</span> height<span class=\"token punctuation\">:</span> <span class=\"token number\">50</span><span class=\"token punctuation\">)</span>\n        label<span class=\"token punctuation\">.</span>center <span class=\"token operator\">=</span> view<span class=\"token punctuation\">.</span>center\n        label<span class=\"token punctuation\">.</span>font <span class=\"token operator\">=</span> font\n        label<span class=\"token punctuation\">.</span>attributedText <span class=\"token operator\">=</span> mutableString\n    <span class=\"token punctuation\">}</span>  </code></pre></div>\n<p>attachmentにsizeを指定すると表示されます。ただそれだと、画像が表示される高さがずれてしまうので、\n今回は中央に揃うように高さを調整しました。</p>\n<p>当たり前ですがinsertする場所をずらせば中央に表示できます\n<img width=\"288\" alt=\"スクリーンショット 2019-05-10 12.00.20.png\" src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/166241/7db10ae9-d48d-8685-ff35-bc21c3237a9b.png\"></p>\n<p>デスクトップに犬の写真しかなかったですが、例えば仮想通貨の保有量＋💶（通過のアイコン）スコア＋👑（王冠やメダル）などが考えられると思います。</p>\n<p>結構コード量が多くてとっつきにくい気もします。</p>\n<h3>Extension</h3>\n<p>うまい感じに共通化したいですが高さを揃えるにはUILabelのfontと表示したい画像のサイズの情報が必要になってきます。\nUILabelのextensionにするのもなんか違う気がしますが一応</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\">    label<span class=\"token punctuation\">.</span>text <span class=\"token operator\">=</span> <span class=\"token string\">\"labelに犬を表示する\"</span>\n    label<span class=\"token punctuation\">.</span><span class=\"token function\">insertImage</span><span class=\"token punctuation\">(</span><span class=\"token function\">UIImage</span><span class=\"token punctuation\">(</span>named<span class=\"token punctuation\">:</span> <span class=\"token string\">\"dog.jpg\"</span><span class=\"token punctuation\">)</span><span class=\"token operator\">!</span><span class=\"token punctuation\">,</span> at<span class=\"token punctuation\">:</span> label<span class=\"token punctuation\">.</span>text<span class=\"token operator\">!</span><span class=\"token punctuation\">.</span><span class=\"token builtin\">count</span><span class=\"token punctuation\">,</span> alignment<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">.</span>center<span class=\"token punctuation\">)</span></code></pre></div>\n<p>sizeはデフォルトでimage.sizeを指定します。</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\">    label<span class=\"token punctuation\">.</span><span class=\"token function\">insertImage</span><span class=\"token punctuation\">(</span><span class=\"token function\">UIImage</span><span class=\"token punctuation\">(</span>named<span class=\"token punctuation\">:</span> <span class=\"token string\">\"dog.jpg\"</span><span class=\"token punctuation\">)</span><span class=\"token operator\">!</span><span class=\"token punctuation\">,</span> at<span class=\"token punctuation\">:</span> label<span class=\"token punctuation\">.</span>text<span class=\"token operator\">!</span><span class=\"token punctuation\">.</span><span class=\"token builtin\">count</span><span class=\"token punctuation\">,</span> size<span class=\"token punctuation\">:</span> <span class=\"token function\">CGSize</span><span class=\"token punctuation\">(</span>width<span class=\"token punctuation\">:</span> <span class=\"token number\">30</span><span class=\"token punctuation\">,</span> height<span class=\"token punctuation\">:</span> <span class=\"token number\">30</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> alignment<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">.</span>center<span class=\"token punctuation\">)</span> </code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">extension</span> <span class=\"token builtin\">UILabel</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">func</span> <span class=\"token function\">insertImage</span><span class=\"token punctuation\">(</span><span class=\"token number\">_</span> image<span class=\"token punctuation\">:</span> <span class=\"token builtin\">UIImage</span><span class=\"token punctuation\">,</span> at index<span class=\"token punctuation\">:</span> <span class=\"token builtin\">Int</span><span class=\"token punctuation\">,</span> size<span class=\"token punctuation\">:</span> <span class=\"token builtin\">CGSize</span><span class=\"token operator\">?</span> <span class=\"token operator\">=</span> <span class=\"token constant\">nil</span><span class=\"token punctuation\">,</span> alignment<span class=\"token punctuation\">:</span> <span class=\"token builtin\">NSTextAttachment</span><span class=\"token punctuation\">.</span><span class=\"token builtin\">VerticalAlignment</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">.</span>center<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">let</span> attr <span class=\"token operator\">=</span> attributedText <span class=\"token keyword\">as</span><span class=\"token operator\">?</span> <span class=\"token builtin\">NSMutableAttributedString</span> <span class=\"token operator\">?</span><span class=\"token operator\">?</span> <span class=\"token function\">NSMutableAttributedString</span><span class=\"token punctuation\">(</span>string<span class=\"token punctuation\">:</span> text <span class=\"token operator\">?</span><span class=\"token operator\">?</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">let</span> attachment <span class=\"token operator\">=</span> <span class=\"token function\">NSTextAttachment</span><span class=\"token punctuation\">(</span>image<span class=\"token punctuation\">:</span> image<span class=\"token punctuation\">,</span> font<span class=\"token punctuation\">:</span> font<span class=\"token punctuation\">,</span> size<span class=\"token punctuation\">:</span> size <span class=\"token operator\">?</span><span class=\"token operator\">?</span> image<span class=\"token punctuation\">.</span>size<span class=\"token punctuation\">,</span> alignment<span class=\"token punctuation\">:</span> alignment<span class=\"token punctuation\">)</span>\n        attr<span class=\"token punctuation\">.</span><span class=\"token function\">insert</span><span class=\"token punctuation\">(</span><span class=\"token function\">NSAttributedString</span><span class=\"token punctuation\">(</span>attachment<span class=\"token punctuation\">:</span> attachment<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> at<span class=\"token punctuation\">:</span> index<span class=\"token punctuation\">)</span>\n        attributedText <span class=\"token operator\">=</span> attr\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">extension</span> <span class=\"token builtin\">NSTextAttachment</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">convenience</span> <span class=\"token keyword\">init</span><span class=\"token punctuation\">(</span>image<span class=\"token punctuation\">:</span> <span class=\"token builtin\">UIImage</span><span class=\"token punctuation\">,</span> font<span class=\"token punctuation\">:</span> <span class=\"token builtin\">UIFont</span><span class=\"token punctuation\">,</span> size<span class=\"token punctuation\">:</span> <span class=\"token builtin\">CGSize</span><span class=\"token punctuation\">,</span> alignment<span class=\"token punctuation\">:</span> <span class=\"token builtin\">VerticalAlignment</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">init</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>image <span class=\"token operator\">=</span> image\n        <span class=\"token keyword\">let</span> y<span class=\"token punctuation\">:</span> <span class=\"token builtin\">CGFloat</span>\n        <span class=\"token keyword\">switch</span> alignment <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">case</span> <span class=\"token punctuation\">.</span>top<span class=\"token punctuation\">:</span>\n            y <span class=\"token operator\">=</span> font<span class=\"token punctuation\">.</span>capHeight <span class=\"token operator\">-</span> size<span class=\"token punctuation\">.</span>height\n        <span class=\"token keyword\">case</span> <span class=\"token punctuation\">.</span>bottom<span class=\"token punctuation\">:</span>\n            y <span class=\"token operator\">=</span> font<span class=\"token punctuation\">.</span>descender\n        <span class=\"token keyword\">case</span> <span class=\"token punctuation\">.</span>center<span class=\"token punctuation\">:</span>\n            y <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>font<span class=\"token punctuation\">.</span>capHeight <span class=\"token operator\">-</span> size<span class=\"token punctuation\">.</span>height<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">rounded</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> <span class=\"token number\">2</span>\n        <span class=\"token keyword\">case</span> <span class=\"token punctuation\">.</span>baseline<span class=\"token punctuation\">:</span>\n            y <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n        <span class=\"token punctuation\">}</span>\n        bounds<span class=\"token punctuation\">.</span>origin <span class=\"token operator\">=</span> <span class=\"token function\">CGPoint</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> y<span class=\"token punctuation\">:</span> y<span class=\"token punctuation\">)</span>\n        bounds<span class=\"token punctuation\">.</span>size <span class=\"token operator\">=</span> size\n    <span class=\"token punctuation\">}</span>\n    \n    <span class=\"token keyword\">enum</span> <span class=\"token builtin\">VerticalAlignment</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">case</span> bottom<span class=\"token punctuation\">,</span> baseline<span class=\"token punctuation\">,</span> center<span class=\"token punctuation\">,</span> top\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>ラベルの上にsizeや表示位置の調整については<a href=\"https://stackoverflow.com/questions/26105803/center-nstextattachment-image-next-to-single-line-uilabel\">こちら</a>を参考にしました。</p>\n<img src=\"https://i.stack.imgur.com/EtmBW.png\">\n<p>引用: (<a href=\"https://stackoverflow.com/questions/26105803/center-nstextattachment-image-next-to-single-line-uilabel\">https://stackoverflow.com/questions/26105803/center-nstextattachment-image-next-to-single-line-uilabel</a>)</p>\n<p>ちなみにy座標は反転していて、UIFont.desendentは-の値を返します。</p>\n<hr>\n<h3>画像ともじのマージンを調整したい場合</h3>\n<p>テキストと画像の間にのマージンを調整したい場合は\nスペースを入れる、fontSizeを調整する、もしくは最悪の場合Paddingをつけた画像を生成する必要があるのかなと思いました。</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\">    <span class=\"token keyword\">func</span> <span class=\"token function\">makeImageWithPadding</span><span class=\"token punctuation\">(</span>image<span class=\"token punctuation\">:</span> <span class=\"token builtin\">UIImage</span><span class=\"token punctuation\">,</span> padding<span class=\"token punctuation\">:</span> <span class=\"token builtin\">UIEdgeInsets</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token builtin\">UIImage</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">UIGraphicsBeginImageContextWithOptions</span><span class=\"token punctuation\">(</span>image<span class=\"token punctuation\">.</span>size<span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span> <span class=\"token builtin\">UIScreen</span><span class=\"token punctuation\">.</span>main<span class=\"token punctuation\">.</span>scale<span class=\"token punctuation\">)</span>\n        <span class=\"token function\">UIGraphicsBeginImageContext</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">init</span><span class=\"token punctuation\">(</span>\n                width<span class=\"token punctuation\">:</span> image<span class=\"token punctuation\">.</span>size<span class=\"token punctuation\">.</span>width <span class=\"token operator\">+</span> padding<span class=\"token punctuation\">.</span><span class=\"token keyword\">left</span> <span class=\"token operator\">+</span> padding<span class=\"token punctuation\">.</span><span class=\"token keyword\">right</span><span class=\"token punctuation\">,</span>\n                height<span class=\"token punctuation\">:</span> image<span class=\"token punctuation\">.</span>size<span class=\"token punctuation\">.</span>height <span class=\"token operator\">+</span> padding<span class=\"token punctuation\">.</span>top <span class=\"token operator\">+</span> padding<span class=\"token punctuation\">.</span>bottom\n            <span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">)</span>\n        image<span class=\"token punctuation\">.</span><span class=\"token function\">draw</span><span class=\"token punctuation\">(</span>at<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">.</span><span class=\"token keyword\">init</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">:</span> padding<span class=\"token punctuation\">.</span><span class=\"token keyword\">left</span><span class=\"token punctuation\">,</span> y<span class=\"token punctuation\">:</span> padding<span class=\"token punctuation\">.</span>top<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">let</span> image <span class=\"token operator\">=</span> <span class=\"token function\">UIGraphicsGetImageFromCurrentImageContext</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">!</span>\n        <span class=\"token function\">UIGraphicsEndImageContext</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">return</span> image\n    <span class=\"token punctuation\">}</span></code></pre></div>\n<h3>(追記) Swift5で強化された機能をつかうと</h3>\n<p><a href=\"https://qiita.com/fmtonakai/items/2e685e3c719d7fda7fc7\">https://qiita.com/fmtonakai/items/2e685e3c719d7fda7fc7</a></p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">let</span> attrStr<span class=\"token punctuation\">:</span> <span class=\"token builtin\">AttributedString</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"今日はいい天気だ<span class=\"token interpolation\"><span class=\"token delimiter variable\">\\(</span>image<span class=\"token delimiter variable\">)</span></span>\"</span></code></pre></div>\n<p>こうゆう実装もできるよう</p>","frontmatter":{"title":"Swift5 UILabelに画像(UIImage)を表示する NSAttributedString NSTextAttachment","tags":["Xcode","iOS","Swift"],"date":"2019年05月10日"}},"sameTagPosts":{"edges":[{"node":{"id":"8845f661-5548-599d-8a4e-6a5320066ede","frontmatter":{"title":"SwiftUIでTextViewを使う","tags":["iOS","Swift","SwiftUI"],"date":"2019年10月27日"}}},{"node":{"id":"c57e83f6-2e10-5f63-abfb-b78c3814e7c3","frontmatter":{"title":"SwiftUIとXcodeのPreviewでオートレイアウトをリアルタイムで確認しながら実装できて感動した","tags":["Xcode","iOS","AutoLayout","Swift","SwiftUI"],"date":"2019年10月16日"}}},{"node":{"id":"36c8d4f0-7394-5bff-b6b5-bae80a8113aa","frontmatter":{"title":"Swift5.1 dynamicMemberLookup^KeyPathを使ってSwiftにKotolinのapplyを実装する","tags":["Xcode","iOS","Kotlin","Swift"],"date":"2019年10月04日"}}},{"node":{"id":"6aa8f8fc-5836-52a8-bd46-ae56d1d4f4de","frontmatter":{"title":"SwiftでTooltipを描画する","tags":["iOS","UIKit","Swift"],"date":"2019年08月31日"}}},{"node":{"id":"fa82a31d-4690-5cb8-a507-42237d6afec2","frontmatter":{"title":"実機１台で別端末のレイアウトを確認する方法","tags":["Xcode","iOS","Swift"],"date":"2019年08月15日"}}}]}},"pageContext":{"id":"defafadb-9d0e-5eed-aaff-b8c93f7d2c89","tags":["Xcode","iOS","Swift"]}}}